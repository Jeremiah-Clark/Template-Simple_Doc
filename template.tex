% template.tex — Pandoc LaTeX template for documents
% All formatting lives here; Markdown files stay pure GFM.
% Style settings (fonts, colors, etc.) are controlled from master.yaml.
\documentclass[$if(fontsize)$$fontsize$$else$11pt$endif$]{article}

% ---------------------------------------------------------------------------
% Core packages
% ---------------------------------------------------------------------------
% Pre-declare hyperref options before any package might load it as a dependency
\PassOptionsToPackage{unicode}{hyperref}

\usepackage[$if(papersize)$$papersize$paper,$endif$margin=1in,top=1.25in,bottom=1.25in]{geometry}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{titlesec}
\usepackage[framemethod=tikz]{mdframed}
\usepackage{longtable,booktabs,array}
\usepackage{amssymb}
\usepackage{calc}

% ---------------------------------------------------------------------------
% Font setup (XeLaTeX / LuaLaTeX)
% ---------------------------------------------------------------------------
\usepackage{ifxetex,ifluatex}
\usepackage{newunicodechar}
\ifxetex
  \usepackage{fontspec}
  \setmainfont{$if(font-body)$$font-body$$else$Noto Sans$endif$}
  \setsansfont{$if(font-heading)$$font-heading$$else$Noto Sans$endif$}
  \setmonofont{$if(font-mono)$$font-mono$$else$Noto Sans Mono$endif$}[Scale=MatchLowercase]
\fi
\ifluatex
  \usepackage{fontspec}
  \setmainfont{$if(font-body)$$font-body$$else$Noto Sans$endif$}
  \setsansfont{$if(font-heading)$$font-heading$$else$Noto Sans$endif$}
  \setmonofont{$if(font-mono)$$font-mono$$else$Noto Sans Mono$endif$}[Scale=MatchLowercase]
\fi
% Redirect any typewriter context to sans-serif (prevents ectt fallback)
\renewcommand{\ttdefault}{\sfdefault}

% Map non-breaking hyphen (U+2011) to a regular hyphen — most fonts lack it
\newunicodechar{‑}{-}

\linespread{$if(linespread)$$linespread$$else$1.15$endif$}

% ---------------------------------------------------------------------------
% Colors (from YAML, with defaults)
% ---------------------------------------------------------------------------
\definecolor{brandblue}{RGB}{$if(color-heading)$$color-heading$$else$25,55,120$endif$}
\definecolor{linkblue}{RGB}{$if(color-link)$$color-link$$else$40,80,180$endif$}

% ---------------------------------------------------------------------------
% Hyperref (must be loaded after fontspec)
% ---------------------------------------------------------------------------
\usepackage{soul}
\setulcolor{linkblue}

\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\urlstyle{same}
\hypersetup{
  unicode=true,
  pdfencoding=unicode,
  colorlinks=true,
  linkcolor=brandblue,
  urlcolor=linkblue,
  breaklinks=true,
  $if(title)$pdftitle={$title$},$endif$
  $if(author)$pdfauthor={$author$},$endif$
  pdfcreator={LaTeX via pandoc}
}
% Underline external links (URLs) while keeping TOC links clean
\let\oldhref\href
\renewcommand{\href}[2]{\oldhref{#1}{\ul{#2}}}

% ---------------------------------------------------------------------------
% Paragraph and list formatting
% ---------------------------------------------------------------------------
\setlength{\parskip}{6pt}
\setlength{\parindent}{0pt}

\setlistdepth{9}
\renewlist{itemize}{itemize}{9}
\setlist[itemize,1]{label=\raisebox{-0.42ex}{\scalebox{1.5}{\textbullet}}}
\setlist[itemize,2]{label=\raisebox{0.15ex}{$$\circ$$}}
\setlist[itemize,3]{label=\raisebox{0.25ex}{\scalebox{0.5}{$$\blacksquare$$}}}
\setlist[itemize,4]{label=$$\ast$$}
\setlist{noitemsep, topsep=0pt, parsep=3pt, partopsep=0pt}

% ---------------------------------------------------------------------------
% Section heading styles
% ---------------------------------------------------------------------------
\titleformat{\section}{\Large\bfseries\sffamily\color{brandblue}}{}{0em}{}
\titleformat{\subsection}{\large\bfseries\sffamily}{}{0em}{}
\titleformat{\subsubsection}{\normalsize\bfseries\sffamily}{}{0em}{}
\setcounter{secnumdepth}{0}

% ---------------------------------------------------------------------------
% Header & footer
% ---------------------------------------------------------------------------
\pagestyle{fancy}
\fancyhf{}
\fancyhead{}
\fancyfoot[L]{$title$$if(version)$\hspace{0.75em}{\small\color{black!60}v$version$}$endif$}
\fancyfoot[R]{Page \thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\fancypagestyle{plain}{\fancyhf{}}

% ---------------------------------------------------------------------------
% Callout / admonition environments  (mdframed)
% ---------------------------------------------------------------------------
% Each environment accepts an optional argument to override the default title:
%   \begin{example}                    → title bar says "Example"
%   \begin{example}[Hand Count Reset]  → title bar says "Hand Count Reset"
%
% Helper macro: \definecallout{envname}{Default Title}{base-color}
% Derives border/title bar (color!80!black) and background (color!5!white)
% from a single base color.

\newcommand{\definecallout}[3]{%
  \newenvironment{#1}[1][#2]{%
    \begin{mdframed}[
      linecolor=#3!80!black, backgroundcolor=#3!5!white,
      linewidth=2pt, roundcorner=2mm,
      innertopmargin=10pt, innerbottommargin=10pt,
      innerleftmargin=10pt, innerrightmargin=10pt,
      skipabove=9pt, skipbelow=6pt, nobreak=true,
      frametitle=##1, frametitlebackgroundcolor=#3!80!black,
      frametitlefont=\bfseries\color{white},
      frametitleaboveskip=4pt, frametitlebelowskip=5pt
    ]%
  }{\end{mdframed}}%
}

\definecallout{important}{Important}{$if(color-important)$$color-important$$else$red$endif$}
\definecallout{note}{Note}{$if(color-note)$$color-note$$else$blue$endif$}
\definecallout{warning}{Warning}{$if(color-warning)$$color-warning$$else$orange$endif$}
\definecallout{tip}{Tip}{$if(color-tip)$$color-tip$$else$green$endif$}
\definecallout{caution}{Caution}{$if(color-caution)$$color-caution$$else$yellow$endif$}
\definecallout{summary}{Summary}{$if(color-summary)$$color-summary$$else$violet$endif$}
\definecallout{example}{Example}{$if(color-example)$$color-example$$else$black$endif$}

% Blockquotes (for any blockquote not converted to an admonition)
\renewenvironment{quote}{%
  \begin{mdframed}[
    linecolor=black!40, backgroundcolor=black!0,
    linewidth=2pt, roundcorner=2mm,
    innertopmargin=10pt, innerbottommargin=10pt,
    innerleftmargin=10pt, innerrightmargin=10pt,
    skipabove=2pt, skipbelow=4pt, nobreak=true
  ]%
}{%
  \end{mdframed}%
}

% Tight list support (Pandoc generates this)
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Scale images that are too wide
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,keepaspectratio}

% ---------------------------------------------------------------------------
% Document
% ---------------------------------------------------------------------------
\begin{document}

% --- Title page (loaded from titlepage.tex) ---
% Pass Pandoc variables into LaTeX commands so titlepage.tex stays pure LaTeX
\newcommand{\doctitle}{$title$}
\newcommand{\docauthor}{$author$}
\newcommand{\docdate}{$date$}
$if(version)$
\newcommand{\docversion}{$version$}
$endif$
$if(logo)$
\newcommand{\doclogo}{$logo$}
$endif$
$if(disclaimer)$
\newcommand{\docdisclaimer}{$disclaimer$}
$endif$
\input{titlepage}

% --- Table of contents ---
$if(toc)$
\renewcommand{\contentsname}{Table of Contents}
\setcounter{tocdepth}{$if(toc-depth)$$toc-depth$$else$3$endif$}
\tableofcontents
\newpage
$endif$

% --- Body ---
$body$

\end{document}
